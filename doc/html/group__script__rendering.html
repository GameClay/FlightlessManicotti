<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FlightlessManacotti: Rendering</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">FlightlessManacotti
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a>  </div>
  <div class="headertitle">
<div class="title">Rendering</div>  </div>
<div class="ingroups"><a class="el" href="group__script.html">Script</a></div></div><!--header-->
<div class="contents">
<hr/><a name="details" id="details"></a><h2> </h2>
<p>Script rendering constructs and functions. </p>
<p>Rendering is fully exposed to script through the <a class="el" href="class_render_list.html" title="Interface to the render list on the runtime.">RenderList</a> and <a class="el" href="class_render_instance.html" title="Interface to the render list on the runtime.">RenderInstance</a> classes.</p>
<p><a class="el" href="class_render.html" title="Interface to the render subsystem of the runtime.">Render</a> constructs should not be created until the <a class="el" href="class_events.html#a7e487f772e8012cfc8340565a02649f0" title="Init event.">Events.renderinit</a> event has been issued. Before this event is sent, there is no valid graphics context on which to create GPU resource.</p>
<p><a class="el" href="class_render_instance.html" title="Interface to the render list on the runtime.">RenderInstance</a> objects are drawn in the order they are inserted into the <a class="el" href="class_render_list.html" title="Interface to the render list on the runtime.">RenderList</a>.</p>
<dl class="section note"><dt>Note:</dt><dd>At some point this will be changed such that sorting can be done properly for translucent instances and depth-test will take care of the rest.</dd></dl>
<h1><a class="anchor" id="script_render_mesh"></a>
Meshes</h1>
<p>A <a class="el" href="class_mesh.html" title="Interface to the runtime mesh library.">Mesh</a> object is required for the runtime to draw a <a class="el" href="class_render_instance.html" title="Interface to the render list on the runtime.">RenderInstance</a>. A <a class="el" href="class_mesh.html" title="Interface to the runtime mesh library.">Mesh</a> can be created manually, or by loading an <a href="http://openctm.sourceforge.net/">OpenCTM</a> mesh.</p>
<p>Example of manually creating a full-screen textured quad <a class="el" href="class_mesh.html" title="Interface to the runtime mesh library.">Mesh</a>. </p>
<div class="fragment"><div class="line"> local verts = {{-1.0, -1.0, 0.0}, {-1.0, 1.01, 0.0}, {1.0, -1.0, 0.0}, {1.0, 1.0, 0.0}}</div>
<div class="line"> local idxs = {0, 1, 2, 1, 3, 2}</div>
<div class="line"> local texcoords = {{0, 0}, {0, 1}, {1, 0}, {1, 1}}</div>
<div class="line"> fs_quad_mesh = <a class="code" href="class_mesh.html" title="Interface to the runtime mesh library.">Mesh</a>.<a class="code" href="class_mesh.html#ac58f23bca7482adf697ff2436aac3d74" title="Create a new Mesh object.">new</a>()</div>
<div class="line"> fs_quad_mesh:<a class="code" href="class_mesh.html#af7b2a7b5f10d3f2cb077799412146885" title="Set the vertex positions of a Mesh.">setpositions</a>(verts)</div>
<div class="line"> fs_quad_mesh:<a class="code" href="class_mesh.html#a0436abcb84f94b509b2602c9e6b81b0b" title="Set the texture coordinates of a Mesh.">settexcoords</a>(texcoords)</div>
<div class="line"> fs_quad_mesh:<a class="code" href="class_mesh.html#aed5c328bce9ca8d974fae4878c3d70dc" title="Set the indices for the Mesh.">setindices</a>(idxs)</div>
<div class="line"> fs_quad_mesh:<a class="code" href="class_mesh.html#a4d8e1b73ef240303a7bd1b9166891d34" title="Update the GPU data of a Mesh object.">update</a>(<a class="code" href="class_mesh.html" title="Interface to the runtime mesh library.">Mesh</a>.element.vertex + <a class="code" href="class_mesh.html" title="Interface to the runtime mesh library.">Mesh</a>.element.index + <a class="code" href="class_mesh.html" title="Interface to the runtime mesh library.">Mesh</a>.element.tex0, <a class="code" href="class_mesh.html" title="Interface to the runtime mesh library.">Mesh</a>.element.none)</div>
</div><!-- fragment --><h1><a class="anchor" id="script_render_textures"></a>
Textures</h1>
<p><a class="el" href="class_texture.html" title="Interface to the render targets in the runtime.">Texture</a> objects can be created from files, or assigned to runtime-exposed data sources.</p>
<p><a class="el" href="class_texture.html" title="Interface to the render targets in the runtime.">Texture</a> files are loaded using the <a href="freeimage.sourceforge.net">FreeImage</a> library.</p>
<p>Data-sources can be registered with the rendering subsystem of the runtime using the kl_effect_manager_register_data_source function.</p>
<p>Example of creating a <a class="el" href="class_texture.html" title="Interface to the render targets in the runtime.">Texture</a> by loading a file. </p>
<div class="fragment"><div class="line"> uv_template_texture = <a class="code" href="class_texture.html" title="Interface to the render targets in the runtime.">Texture</a>.<a class="code" href="class_texture.html#a5d8d6601460229bc4f4f568fac75383d" title="Create a new Texture object.">new</a>[[uvtemplate001-lg.jpg]]</div>
</div><!-- fragment --><p>Example of creating a <a class="el" href="class_texture.html" title="Interface to the render targets in the runtime.">Texture</a> by binding a data-source, from Zorya. </p>
<div class="fragment"><div class="line"> cqt.texture.spectrum = <a class="code" href="class_texture.html" title="Interface to the render targets in the runtime.">Texture</a>.<a class="code" href="class_texture.html#a5d8d6601460229bc4f4f568fac75383d" title="Create a new Texture object.">new</a>(Zorya.data.cqt_spectrum)</div>
</div><!-- fragment --><dl class="section note"><dt>Note:</dt><dd>Currently data-source textures are hard-coded to be 1d textures. This will be changed to respect the proper dimensions of the data-source.</dd></dl>
<h1><a class="anchor" id="script_render_materials"></a>
Materials</h1>
<p>Materials are defined in Lua using the DeclareShader function inside a file named for the material. All rendering must be done with shaders since FlightlessManicotti uses OpenGL 3.2+.</p>
<p>This is an example of a simple texture material which is located at <a class="el" href="_color_texture_8lua.html">script/render/shaders/ColorTexture.lua</a> </p>
<div class="fragment"><div class="line">require <span class="stringliteral">&#39;render.ShaderFactory&#39;</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="_shader_factory_8lua.html#a4ac5055d28ae647c13a07ae9fdd45170" title="Define a shader for use by the rendering subsystem.">DeclareShader</a>(<span class="stringliteral">&#39;Vertex.GL3&#39;</span>, [[</div>
<div class="line">   in vec3 InPosition;</div>
<div class="line">   in vec2 InTex0;</div>
<div class="line"></div>
<div class="line">   out vec2 <a class="code" href="_color_texture_8lua.html#a0667514610713e01c439e6d024753277">tex_coord0</a>;</div>
<div class="line">   out vec4 <a class="code" href="_color_texture_8lua.html#aeba488d956962b588a46aa700bd07431">color0</a>;</div>
<div class="line"></div>
<div class="line">   uniform vec4 color;</div>
<div class="line">   uniform mat4 object_to_screen;</div>
<div class="line"></div>
<div class="line">   <span class="keywordtype">void</span> main()</div>
<div class="line">   {</div>
<div class="line">      <a class="code" href="_color_texture_8lua.html#a0f11fe69293c04f2060d52dbd8acda16">gl_Position</a> = object_to_screen * vec4(InPosition, 1.0);</div>
<div class="line">      tex_coord0 = InTex0.xy;</div>
<div class="line">      color0 = color;</div>
<div class="line">   }</div>
<div class="line">]])</div>
<div class="line"></div>
<div class="line"><a class="code" href="_shader_factory_8lua.html#a4ac5055d28ae647c13a07ae9fdd45170" title="Define a shader for use by the rendering subsystem.">DeclareShader</a>(<span class="stringliteral">&#39;Fragment.GL3&#39;</span>, [[</div>
<div class="line">   in vec2 tex_coord0;</div>
<div class="line">   in vec4 <a class="code" href="_color_texture_8lua.html#aeba488d956962b588a46aa700bd07431">color0</a>;</div>
<div class="line"></div>
<div class="line">   out vec4 <a class="code" href="_color_texture_8lua.html#a76f68145f31b171529d28cf47eb3b448">fragout0</a>;</div>
<div class="line"></div>
<div class="line">   uniform sampler2D tex0;</div>
<div class="line"></div>
<div class="line">   <span class="keywordtype">void</span> main()</div>
<div class="line">   {</div>
<div class="line">      fragout0 = texture(tex0, tex_coord0) * <a class="code" href="_color_texture_8lua.html#aeba488d956962b588a46aa700bd07431">color0</a>;</div>
<div class="line">   }</div>
<div class="line">]])</div>
</div><!-- fragment --><h1><a class="anchor" id="script_render_shader_consts"></a>
Shader Constants</h1>
<p>Shader constants are specified by Lua tables, as name-value pairs. <a class="el" href="class_texture.html" title="Interface to the render targets in the runtime.">Texture</a> objects as well as <a class="el" href="class_render_target.html" title="Interface to the render targets in the runtime.">RenderTarget</a> objects can be specified as bindings for sampler constants. Float, vec2, vec3, and vec4 arrays and constants are also specified using Lua tables.</p>
<dl class="section note"><dt>Note:</dt><dd>Due to the fact that all Lua numbers in LuaJIT are doubles, there is currently no support for integer constant assignment. All numerical constants are treated as floating point types.</dd></dl>
<p>Example of assigning a texture, and vec4 shader constant. </p>
<div class="fragment"><div class="line"> fs_quad_inst:<a class="code" href="class_render_instance.html#a516b3716a8015d281f5fc278c48bd15b" title="Set the shader constants for a RenderInstance.">setshaderconstants</a>({</div>
<div class="line">    tex0 = uv_template_texture,</div>
<div class="line">    color = {{1, 1, 1, 1}}</div>
<div class="line"> })</div>
</div><!-- fragment --><h1><a class="anchor" id="script_render_instances"></a>
Render Instances</h1>
<p>Example of creating a <a class="el" href="class_render_instance.html" title="Interface to the render list on the runtime.">RenderInstance</a> to draw a full-screen textured quad. </p>
<div class="fragment"><div class="line"> fs_quad_inst = <a class="code" href="class_render_instance.html" title="Interface to the render list on the runtime.">RenderInstance</a>.<a class="code" href="class_render_instance.html#ac58f23bca7482adf697ff2436aac3d74" title="Create a new RenderInstance object.">new</a>()</div>
<div class="line"> fs_quad_inst:<a class="code" href="class_render_instance.html#a0924aa85a16c0b872c41143efc51318b" title="Assign a Mesh to a RenderInstance.">setmesh</a>(fs_quad_mesh)</div>
<div class="line"> fs_quad_inst:<a class="code" href="class_render_instance.html#a348dc03eccb3347253788179bc0a9551" title="Assign a material to a RenderInstance.">setmaterial</a>(&quot;ColorTexture&quot;)</div>
<div class="line"> fs_quad_inst:<a class="code" href="class_render_instance.html#aeab7d1bb162c6a736597715994882bd8" title="Set the draw type of a RenderInstance.">setdrawtype</a>(<a class="code" href="class_render_instance.html" title="Interface to the render list on the runtime.">RenderInstance</a>.<a class="code" href="_render_instance_8lua.html#a1d75a456405c8b6b4d65ce4f4b1ecff9">drawtype</a>.<a class="code" href="_render_instance_8lua.html#a6e289834e0d6128456a1ba237e1a8a88" title="Draw a Mesh as triangles.">triangles</a>)</div>
<div class="line"> fs_quad_inst:<a class="code" href="class_render_instance.html#a516b3716a8015d281f5fc278c48bd15b" title="Set the shader constants for a RenderInstance.">setshaderconstants</a>({</div>
<div class="line">    tex0 = uv_template_texture,</div>
<div class="line">    color = {{1, 1, 1, 1}}</div>
<div class="line"> })</div>
</div><!-- fragment --><h1><a class="anchor" id="script_render_targets"></a>
Render Targets</h1>
<p><a class="el" href="class_render.html" title="Interface to the render subsystem of the runtime.">Render</a> targets can be specified for each <a class="el" href="class_render_instance.html" title="Interface to the render list on the runtime.">RenderInstance</a>. By default, a <a class="el" href="class_render_instance.html" title="Interface to the render list on the runtime.">RenderInstance</a> has its target assigned to 'nil', or the backbuffer. A new <a class="el" href="class_render_instance.html" title="Interface to the render list on the runtime.">RenderInstance</a> can be created and assigned.</p>
<dl class="section note"><dt>Note:</dt><dd>Currently a <a class="el" href="class_render_target.html" title="Interface to the render targets in the runtime.">RenderTarget</a> is created with an attached 24-bit depth buffer and an 8-bit stencil buffer. The color format is 32-bit RGBA. At some point this will be configurable on creation/update.</dd></dl>
<p>Example of creating a set of feedback buffers using <a class="el" href="class_render_target.html" title="Interface to the render targets in the runtime.">RenderTarget</a>, from Zorya. </p>
<div class="fragment"><div class="line"> cqt.targets.feedback = {<a class="code" href="class_render_target.html" title="Interface to the render targets in the runtime.">RenderTarget</a>.<a class="code" href="class_render_target.html#aec0d6f74f578c57d07156b25e4e382f9" title="Create a new RenderTarget object.">new</a>(512, 512), <a class="code" href="class_render_target.html" title="Interface to the render targets in the runtime.">RenderTarget</a>.<a class="code" href="class_render_target.html#aec0d6f74f578c57d07156b25e4e382f9" title="Create a new RenderTarget object.">new</a>(512, 512)}</div>
</div><!-- fragment --> <table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_mesh.html">Mesh</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interface to the runtime mesh library.  <a href="class_mesh.html#details">More...</a><br/></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_render.html">Render</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interface to the render subsystem of the runtime.  <a href="class_render.html#details">More...</a><br/></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_render_instance.html">RenderInstance</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interface to the render list on the runtime.  <a href="class_render_instance.html#details">More...</a><br/></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_render_list.html">RenderList</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interface to the render list on the runtime.  <a href="class_render_list.html#details">More...</a><br/></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_render_target.html">RenderTarget</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interface to the render targets in the runtime.  <a href="class_render_target.html#details">More...</a><br/></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shader_constant_assigner.html">ShaderConstantAssigner</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Contains engine-provided shader constant bindings.  <a href="class_shader_constant_assigner.html#details">More...</a><br/></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_texture.html">Texture</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interface to the render targets in the runtime.  <a href="class_texture.html#details">More...</a><br/></td></tr>
</table>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jun 13 2012 15:32:17 for FlightlessManacotti by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1
</small></address>
</body>
</html>
